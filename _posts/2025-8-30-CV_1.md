---
title: 计算机视觉（1）数据增强
tags: DL CV
typora-root-url: ./..
---

总结计算机视觉图像增强的一些方法。

<!--more-->

torchvision官方文档：https://docs.pytorch.org/vision/stable/transforms.html

![ImageAugmentation](/images/CV/ImageAugmentation.png)

##### 1.练习图片

![panda](/images/CV/panda.png)

使用PIL库里面的Image函数导入图片。

~~~
from PIL import Image

img = Image.open("panda.png")
img.show()            
~~~

查看图片的基本信息。

~~~
# 输出图像格式
print(f"格式: {img.format}")
# 输出宽×高
print(f"尺寸: {img.size}")
# 输出色彩模式
print(f"模式: {img.mode}")
~~~

定义一个应用函数，传入图像、变换方法，完成变换后，再显示图像。

~~~
from PIL import Image
from torchvision import transforms

# img:图像；aug:变换方法
def apply(img, aug):
    transform = aug

    img_filp = transform(transforms.ToTensor()(img))

    img_filp_pil = transforms.ToPILImage()(img_filp)

    img.show()
    img_filp_pil.show()
~~~

##### 2.空间变换

###### 2.1 旋转

~~~
img = Image.open("panda.png")

# RandomRotatio：随机旋转
# degrees:旋转角度的范围
# interpolation：插值方法
#  - InterpolationMode.BILINEAR，双线性插值，默认
#  - InterpolationMode.NEAREST：最近邻插值
#  - InterpolationMode.NEAREST_EXACT：最近邻插值
#  - InterpolationMode.BICUBIC：双三次插值
# expand：是否扩大输出画布，使得整个旋转后图像不被裁剪
# center：旋转中心点坐标 (x, y)，原点在左上角；None 表示以图像中心为旋转中心
# fill：旋转后空白区域的填充值

apply(img, transforms.RandomRotation(degrees=70))
~~~

###### 2.2 翻转

2.2.1 水平翻转

~~~
img = Image.open("panda.png")

# RandomHorizontalFlip：水平翻转
# p为概率，默认0.5

apply(img, transforms.RandomHorizontalFlip(p=1))
~~~

2.2.2 垂直翻转

~~~
img = Image.open("panda.png")

# RandomVerticalFlip：垂直翻转
# p为概率，默认0.5

apply(img, transforms.RandomVerticalFlip(p=1))
~~~

###### 2.3 缩放

~~~
img = Image.open("panda.png")

# Resize：缩放
# size:输出尺寸
# interpolation：图像缩放时使用的插值方法
#  - InterpolationMode.BILINEAR，双线性插值，默认
#  - InterpolationMode.NEAREST：最近邻插值
#  - InterpolationMode.NEAREST_EXACT：最近邻插值
#  - InterpolationMode.BICUBIC：双三次插值
# max_size：调整尺寸后，图像长边的最大允许尺寸
# antialias：是否使用抗锯齿技术，默认True

apply(img, transforms.Resize((200,200)))
~~~

###### 2.4 裁剪

2.4.1 中心裁剪

~~~
img = Image.open("panda.png")

# CenterCrop：中心裁剪
# size:输出尺寸

apply(img, transforms.CenterCrop((400, 400)))
~~~

2.4.2 随机裁剪

~~~
img = Image.open("panda.png")

# RandomCrop：随机裁剪
# size:输出尺寸
# padding:裁剪前在图像边缘填充的像素数，默认None
# pad_if_needed：若图像小于 `size`，是否强制填充后再裁剪，默认False
# fill：填充区域的像素值，默认0
# padding_mode：填充模式（constant/edge/reflection/symmetric）

apply(img, transforms.RandomCrop((400, 400)))
~~~

2.4.3 随机裁剪并缩放

~~~
img = Image.open("panda.png")

# RandomResizedCrop：随机裁剪并缩放
# size:输出尺寸
# scale:裁剪区域面积相对于原图像面积的取值范围
# ratio：裁剪区域宽高比的取值范围
# 根据scale和ratio随机选择一个符合该大小的矩形区域裁剪
# interpolation：图像缩放时使用的插值方法
#  - InterpolationMode.BILINEAR，双线性插值，默认
#  - InterpolationMode.NEAREST：最近邻插值
#  - InterpolationMode.NEAREST_EXACT：最近邻插值
#  - InterpolationMode.BICUBIC：双三次插值
# antialias：是否使用抗锯齿技术，默认True

apply(img, transforms.RandomResizedCrop(
            (200, 200), scale=(0.1, 1), ratio=(0.5, 2)))
~~~

2.4.4 基于交并比的随机裁剪

~~~
img = Image.open("panda.png")

# RandomIoUCrop：基于交并比（Intersection over Union，IoU）的随机裁剪
# 主要用于目标检测，使裁剪图像与原图像中的目标框有重叠关系，保留目标信息
# min_ious:指定裁剪区域与目标框之间最小 IoU 的取值范围
# min_crop_size：裁剪区域的最小尺寸，0-1取值
# aspect_ratio:裁剪区域宽高比的取值范围
# max_attempts:尝试进行裁剪的最大次数
# sampling_method:采样方法
#   - 默认"range":在指定的 IoU 范围中均匀采样
#   - 可选"choice":从指定的 IoU 值中随机选择。

apply(img, transforms.RandomIoUCrop(
    min_ious=[0.1, 0.3, 0.5, 0.7, 0.9], min_crop_size=0.3))
~~~

2.4.5 固定位置裁剪

~~~
img = Image.open("panda.png")

# FixedCrop：固定位置裁剪
# top：裁剪区域距离图像顶部的像素数
# left：裁剪区域距离图像左侧的像素数
# height：裁剪区域的高度
# width：裁剪区域的宽度

apply(img, transforms.FixedCrop(top=10, 
            left=20, height=100, width=150))
~~~

###### 2.5 仿射

~~~
img = Image.open("panda.png")

# RandomAffine：随机裁剪并缩放
# degrees:旋转角度范围
# translate:平移比例。给出 (dx, dy)，其中 dx, dy ∈ [0, 1]
# scale：缩放比例范围。在 [smin, smax] 内随机采样一个比例因子，对整图均匀缩放
# shear：裁剪范围
# interpolation：图像缩放时使用的插值方法
#  - InterpolationMode.BILINEAR，双线性插值，默认
#  - InterpolationMode.NEAREST：最近邻插值
#  - InterpolationMode.NEAREST_EXACT：最近邻插值
#  - InterpolationMode.BICUBIC：双三次插值
# fill：填充区域的像素值，默认0
# center：旋转/缩放/剪切的中心点

apply(img, transforms.RandomAffine(degrees=70))
~~~

##### 3.颜色扰动（亮度、对比度、饱和度、色相/色调）

~~~
img = Image.open("panda.png")

# ColorJitter:改变图像颜色
# brightness:随机调整图像的亮度，单个非负数或二元组 (min, max)
# contrast:随机调整图像的对比度，单个非负数或二元组 (min, max)
# saturation:随机调整图像的色彩饱和度，单个非负数或二元组 (min, max)
# hue:随机调整图像的色调，[-0.5, 0.5]之间的非负数，或二元组 (min, max)
# 0表示不变
apply(img, transforms.ColorJitter(
            brightness=0.9, contrast=0, saturation=0, hue=0))
~~~

##### 4.多种方式结合

~~~
img = Image.open("panda.png")

a = transforms.CenterCrop((600, 600))
b = transforms.ColorJitter(
            brightness=0.5, contrast=0, saturation=0, hue=0)
c = transforms.Resize((400,400))

apply(img,transforms.Compose([a,b,c]))
~~~

##### 5.逐通道标准化

~~~
img = Image.open("panda.png")

a = transforms.CenterCrop((600, 600))
b = transforms.ColorJitter(
            brightness=0.5, contrast=0, saturation=0, hue=0)
c = transforms.Resize((400,400))
# 均值和标准差长度为通道数
d = transforms.Normalize(mean=[0.485, 0.456, 0.406],
                         std =[0.229, 0.225, 0.225])

apply(img,transforms.Compose([a,b,c,d]))
~~~



